---
---
<button
  class="theme-toggle p-2 rounded-full text-muted hover:text-main hover:bg-subtle/10 transition-colors ml-2"
  aria-label="Toggle theme"
>
  <!-- Sun icon (for light mode - show when dark) -->
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="h-5 w-5 hidden dark:block"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
    />
  </svg>

  <!-- Moon icon (for dark mode - show when light) -->
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="h-5 w-5 block dark:hidden"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
    />
  </svg>
</button>

<script>
  document.addEventListener('astro:page-load', () => {
    const themeToggleBtns = document.querySelectorAll('.theme-toggle');

    themeToggleBtns.forEach(btn => {
      // Clean up old listeners by cloning (simple way to wipe listeners)
      // or just trust that on page load (swap) elements are new.
      // On initial load, they are new.
      // On soft nav, the Header persists? 
      // Header is NOT marked with `transition:persist`. So it is re-rendered.
      // So elements are fresh. We don't need to worry about dupes.
      
      btn.addEventListener('click', (e) => {
        // Prevent default just in case
        e.preventDefault();
        
        // Toggle class
        const isDark = document.documentElement.classList.toggle('dark');
        
        // Save preference
        localStorage.setItem('theme', isDark ? 'dark' : 'light');

        // Update theme-color meta tag
        const themeColor = document.querySelector('meta[name="theme-color"]');
        if (themeColor) {
          themeColor.setAttribute('content', isDark ? '#1A1614' : '#FDFBF7');
        }
      });
    });
  });
</script>
