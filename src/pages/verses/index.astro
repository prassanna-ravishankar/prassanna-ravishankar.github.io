---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Handle query parameters - redirect to clean URL if present
if (Astro.url.search) {
  // Use 301 redirect for SEO benefits, ensuring trailing slash consistency
  return Astro.redirect('/verses/', 301);
}

// Get all verses that are not drafts
const verses = await getCollection('verses', ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

// Sort verses by date (newest first)
const sortedVerses = verses.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// SEO-optimized meta description
const versesDescription = `Explore ${verses.length} philosophical verses and poetry by Prassanna Ravishankar. Contemplations on technology, existence, and the human condition. Latest verses: ${sortedVerses.slice(0, 2).map(v => v.data.title).join(' and ')}.`;
---

<Layout 
  title="Verses | Prassanna Ravishankar" 
  description={versesDescription}
>
  <section class="py-24 px-4 min-h-screen relative overflow-hidden bg-background">
     
    <div class="container mx-auto relative z-10 max-w-4xl">
      <header class="text-center mb-20 space-y-4 animate-fade-in-down">
        <h1 class="text-6xl font-display font-bold text-white tracking-tight">Verses</h1>
        <p class="text-xl text-zinc-400 font-light">
          Observations on the human machine.
        </p>
      </header>

      <div class="grid gap-8">
        {sortedVerses.map(verse => (
          <article class="modern-card p-0 flex flex-col md:flex-row overflow-hidden group">
            {verse.data.image && (
              <a href={`/verses/${verse.slug}/`} class="w-full md:w-1/3 relative overflow-hidden h-48 md:h-auto">
                 <div class="absolute inset-0 bg-primary/10 group-hover:bg-transparent transition-colors z-10"></div>
                <img 
                  src={verse.data.image} 
                  alt={verse.data.title}
                  class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110 grayscale group-hover:grayscale-0"
                />
              </a>
            )}
            
            <div class="p-8 md:w-2/3 flex flex-col justify-center">
              <div class="flex items-center gap-3 mb-3 text-xs font-mono text-zinc-500 uppercase tracking-wider">
                <time datetime={verse.data.pubDate.toISOString()}>
                  {new Date(verse.data.pubDate).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric'
                  })}
                </time>
                <div class="h-px w-8 bg-zinc-800"></div>
              </div>

              <h2 class="text-2xl font-bold mb-3">
                <a 
                  href={`/verses/${verse.slug}/`} 
                  class="text-white group-hover:text-primary-light transition-colors"
                >
                  {verse.data.title}
                </a>
              </h2>
              
              {verse.data.description && (
                <p class="text-zinc-400 leading-relaxed mb-6 font-light">
                  {verse.data.description}
                </p>
              )}
              
              <div class="flex items-center gap-2">
                {verse.data.tags?.map(tag => (
                  <span class="text-xs text-zinc-600 font-mono">
                    #{tag}
                  </span>
                ))}
              </div>
            </div>
          </article>
        ))}
      </div>
    </div>
  </section>
</Layout> 