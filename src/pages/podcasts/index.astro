---
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import { podcasts } from '../../data/podcasts.js';

// Get all podcast episodes
const episodes = await getCollection('podcasts', ({ data }) => {
  return import.meta.env.PROD ? !data.draft : true;
});

// Sort episodes by date (newest first)
const sortedEpisodes = episodes.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

// Get latest episodes for display
const latestEpisodes = sortedEpisodes.slice(0, 6);

// Format date function
const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
};

// SEO-optimized meta description
const podcastsDescription = `Listen to ${episodes.length} podcast episodes across ${podcasts.length} shows by Prassanna Ravishankar. Discussions on AI, technology, startups, and machine learning. Latest episodes: ${latestEpisodes.map(e => e.data.title).join(', ')}.`;

// Podcasts-specific structured data
const structuredData = {
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "Podcasts by Prassanna Ravishankar", 
  "description": podcastsDescription,
  "url": "https://prassanna.io/podcasts/",
  "author": {
    "@type": "Person",
    "name": "Prassanna Ravishankar",
    "url": "https://prassanna.io",
    "sameAs": [
      "https://github.com/prassanna-ravishankar",
      "https://linkedin.com/in/prassanna-ravishankar", 
      "https://x.com/thenomadiccoder"
    ]
  },
  "mainEntity": podcasts.map(podcast => ({
    "@type": "PodcastSeries",
    "name": podcast.title,
    "description": podcast.description,
    "url": `https://prassanna.io/podcasts/${podcast.slug}/`,
    "author": {
      "@type": "Person", 
      "name": "Prassanna Ravishankar"
    },
    "genre": "Technology",
    "image": podcast.imageUrl || "https://prassanna.io/images/profile.jpg"
  }))
};
---

<Layout 
  title="Podcasts - Prassanna Ravishankar" 
  description={podcastsDescription}
  structuredData={structuredData}
>
  <main class="container mx-auto px-4 py-8">
    <h1 class="text-3xl md:text-4xl font-semibold mb-6 text-center text-neutral-900 dark:text-neutral-100">Podcasts</h1>
    
    <p class="text-lg mb-8 text-center text-neutral-600 dark:text-neutral-400 max-w-3xl mx-auto leading-relaxed">
      Conversations about AI, technology, and the future of software development. 
      Exploring ideas with industry experts and thought leaders.
    </p>
    
    <!-- Podcast Shows -->
    <section class="mb-12">
      <h2 class="text-xl font-semibold mb-6 text-center text-neutral-800 dark:text-neutral-200">Podcast Shows</h2>
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {podcasts.map((podcast) => (
          <article class="card-elegant group">
            <div class="image-elegant mb-4">
              <Image 
                src={podcast.imageUrl} 
                alt={podcast.title}
                width={400}
                height={225}
                loading="lazy"
                class="w-full h-48 object-cover rounded-lg"
              />
            </div>
            <div class="p-4">
              <header class="mb-3">
                <h2 class="text-lg font-semibold mb-2 leading-tight group-hover:text-accent-600 dark:group-hover:text-accent-400 transition-colors">
                  <a 
                    href={`/podcasts/${podcast.slug}/`}
                    class="link-elegant"
                  >
                    {podcast.title}
                  </a>
                </h2>
                <span class="text-sm text-neutral-500 dark:text-neutral-400">
                  Podcast Show
                </span>
              </header>
              <p class="text-neutral-600 dark:text-neutral-400 mb-3 line-clamp-3 leading-relaxed text-sm">
                {podcast.description}
              </p>
              <a href={`/podcasts/${podcast.slug}/`} class="link-elegant text-sm font-medium">
                View episodes â†’
              </a>
            </div>
          </article>
        ))}
      </div>
    </section>
    
    <!-- Latest Episodes -->
    <section>
      <h2 class="text-xl font-semibold mb-6 text-center text-neutral-800 dark:text-neutral-200">Latest Episodes</h2>
      <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
        {latestEpisodes.map((episode) => (
          <article class="card-elegant group">
            <div class="p-4">
              <header class="mb-3">
                <h3 class="text-lg font-semibold mb-2 leading-tight group-hover:text-accent-600 dark:group-hover:text-accent-400 transition-colors">
                  <a 
                    href={`/podcasts/${episode.slug}/`}
                    class="link-elegant"
                  >
                    {episode.title}
                  </a>
                </h3>
                <span class="text-sm text-neutral-500 dark:text-neutral-400">
                  {episode.show}
                </span>
              </header>
              <p class="text-neutral-600 dark:text-neutral-400 mb-3 line-clamp-3 leading-relaxed text-sm">
                {episode.description}
              </p>
              <a href={episode.youtube} class="btn-primary text-sm font-medium inline-flex items-center">
                <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                </svg>
                Watch on YouTube
              </a>
            </div>
          </article>
        ))}
      </div>
    </section>
  </main>
</Layout> 