---
import Layout from '../layouts/Layout.astro';
import NeuralBackground from '../components/NeuralBackground.astro';
import TerminalWidget from '../components/TerminalWidget.astro';
import ProjectCard3D from '../components/ProjectCard3D.astro';
import TechRadar from '../components/TechRadar.astro';
import PodcastWaveform from '../components/PodcastWaveform.astro';
import D3TagConstellation from '../components/D3TagConstellation.astro';
import { getCollection } from 'astro:content';
import { getStaticPodcastData } from '../utils/podcastRSS.js';

// Get featured projects
const allProjects = await getCollection('projects');
const featuredProjects = allProjects
  .filter(project => project.data.featured)
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 3);

// Get latest blog posts for tag constellation
const allPosts = await getCollection('blog');
const latestPosts = allPosts
  .sort((a, b) => new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime())
  .slice(0, 6);

// Generate tag data for constellation
const tagMap = new Map();
allPosts.forEach(post => {
  post.data.tags?.forEach(tag => {
    if (!tagMap.has(tag)) {
      tagMap.set(tag, { name: tag, count: 0, posts: [] });
    }
    const tagData = tagMap.get(tag);
    tagData.count++;
    tagData.posts.push({
      title: post.data.title,
      url: `/blog/${post.slug}`,
      description: post.data.description || ''
    });
  });
});

const tagData = Array.from(tagMap.values())
  .sort((a, b) => b.count - a.count)
  .slice(0, 15);

// Real podcast data from RSS feed
const podcastData = getStaticPodcastData();
const featuredPodcasts = podcastData.episodes.slice(0, 2).map((episode, index) => ({
  title: episode.title,
  duration: episode.duration,
  description: episode.description,
  url: episode.link || `#episode-${episode.id}`,
  audioUrl: episode.audioUrl,
  episodeNumber: episode.episodeNumber,
  season: episode.season,
  date: episode.pubDate.toLocaleDateString('en-US', { month: 'short', year: 'numeric' }),
  featured: index === 0
}));
---

<Layout 
  title="Prassanna Ravishankar - AI Engineer's Digital Lab | ML Infrastructure & MLOps Expert"
  description="Principal MLOps Engineer specializing in AI infrastructure, machine learning systems, and production ML. Explore cutting-edge projects, technical insights, and AI engineering solutions."
  image="/images/hero-og.jpg"
>
  <link rel="stylesheet" href="/src/styles/design-system.css" />
  
  <main class="lab-container">
    <!-- Hero Section with Neural Background -->
    <section class="hero-section">
      <NeuralBackground />
      <div class="hero-content">
        <div class="hero-text">
          <h1 class="heading-hero animate-fade-in">
            Welcome to the <span class="text-gradient gradient-rainbow">AI Engineer's Lab</span>
          </h1>
          <p class="hero-subtitle text-body animate-slide-up">
            Where cutting-edge AI research meets practical engineering. 
            Explore my journey through machine learning, infrastructure, and the future of intelligent systems.
          </p>
          <div class="hero-actions animate-scale-in">
            <a href="/projects" class="btn btn-primary">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
              </svg>
              Explore Projects
            </a>
            <a href="/hire-me" class="btn btn-secondary">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
              </svg>
              Let's Connect
            </a>
          </div>
        </div>
        
        <!-- Terminal Widget -->
        <div class="terminal-container">
          <TerminalWidget />
        </div>
      </div>
    </section>

    <!-- Current Explorations Section -->
    <section class="explorations-section">
      <div class="section-header">
        <h2 class="heading-section">Current Explorations</h2>
        <p class="text-body">
          Live experiments and ongoing research at the intersection of AI and engineering
        </p>
      </div>
      
      <div class="explorations-grid">
        <div class="exploration-card card-glass">
          <div class="exploration-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
            </svg>
          </div>
          <h3 class="heading-card">Agent Frameworks</h3>
          <p class="text-body">
            Building next-generation AI agents that can reason, plan, and execute complex tasks autonomously
          </p>
          <div class="exploration-tags">
            <span class="badge badge-primary">LangChain</span>
            <span class="badge badge-secondary">AutoGPT</span>
            <span class="badge badge-accent">CrewAI</span>
          </div>
        </div>
        
        <div class="exploration-card card-glass">
          <div class="exploration-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          <h3 class="heading-card">Modal Computing</h3>
          <p class="text-body">
            Revolutionizing ML infrastructure with serverless GPU computing and seamless scaling
          </p>
          <div class="exploration-tags">
            <span class="badge badge-primary">Serverless ML</span>
            <span class="badge badge-secondary">GPU Scaling</span>
          </div>
        </div>
        
        <div class="exploration-card card-glass">
          <div class="exploration-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
            </svg>
          </div>
          <h3 class="heading-card">Multimodal AI</h3>
          <p class="text-body">
            Exploring the convergence of vision, language, and reasoning in next-gen AI systems
          </p>
          <div class="exploration-tags">
            <span class="badge badge-primary">CLIP</span>
            <span class="badge badge-secondary">GPT-4V</span>
            <span class="badge badge-accent">Flamingo</span>
          </div>
        </div>
      </div>
    </section>

    <!-- Technology Radar Section -->
    <section class="tech-radar-section">
      <TechRadar />
    </section>

    <!-- Featured Projects Section -->
    <section class="projects-section">
      <div class="section-header">
        <h2 class="heading-section">Featured Projects</h2>
        <p class="text-body">
          A showcase of innovative AI applications and infrastructure tools
        </p>
      </div>
      
      <div class="projects-grid">
        {featuredProjects.map(project => (
          <ProjectCard3D
            title={project.data.title}
            description={project.data.description}
            image={project.data.image}
            tags={project.data.tags}
            github={project.data.github}
            demo={project.data.demo}
            featured={project.data.featured}
            stars={project.data.stars}
            lastCommit={project.data.lastCommit}
          />
        ))}
      </div>
      
      <div class="section-footer">
        <a href="/projects" class="btn btn-ghost">
          View All Projects
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        </a>
      </div>
    </section>

    <!-- Podcast Section -->
    <section class="podcast-section">
      <div class="section-header">
        <h2 class="heading-section">Latest Conversations</h2>
        <p class="text-body">
          Deep dives into AI, engineering, and the future of technology
        </p>
      </div>
      
      <div class="podcast-grid">
        {featuredPodcasts.map(podcast => (
          <PodcastWaveform
            title={podcast.title}
            duration={podcast.duration}
            description={podcast.description}
            url={podcast.url}
            audioUrl={podcast.audioUrl}
            episodeNumber={podcast.episodeNumber}
            season={podcast.season}
            date={podcast.date}
            featured={podcast.featured}
          />
        ))}
      </div>
    </section>

    <!-- Knowledge Constellation Section -->
    <section class="constellation-section">
      <D3TagConstellation tags={tagData} />
    </section>

    <!-- Connect Section -->
    <section class="connect-section">
      <div class="connect-content card-glass">
        <h2 class="heading-section">Let's Build the Future Together</h2>
        <p class="text-body">
          Whether you're looking to collaborate on cutting-edge AI research, 
          need help scaling your ML infrastructure, or want to discuss the latest 
          in artificial intelligence - I'd love to connect.
        </p>
        
        <div class="connect-grid">
          <a href="/hire-me" class="connect-card">
            <div class="connect-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0V6a2 2 0 00-2 2H6a2 2 0 00-2-2V6m8 0h4a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V8a2 2 0 012-2h4"/>
              </svg>
            </div>
            <h3 class="heading-card">Work Together</h3>
            <p class="text-caption">Consulting • Full-time • Contract</p>
          </a>
          
          <a href="/blog" class="connect-card">
            <div class="connect-icon">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/>
              </svg>
            </div>
            <h3 class="heading-card">Read & Learn</h3>
            <p class="text-caption">Technical insights • Tutorials • Research</p>
          </a>
          
          <a href="https://github.com/prassanna-ravishankar" target="_blank" class="connect-card">
            <div class="connect-icon">
              <svg viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
              </svg>
            </div>
            <h3 class="heading-card">Open Source</h3>
            <p class="text-caption">Code • Contributions • Collaboration</p>
          </a>
        </div>
      </div>
    </section>
  </main>
</Layout>

<style>
  .lab-container {
    min-height: 100vh;
    background: var(--color-bg-primary);
  }

  /* Hero Section */
  .hero-section {
    position: relative;
    min-height: 100vh;
    display: flex;
    align-items: center;
    overflow: hidden;
  }

  .hero-content {
    position: relative;
    z-index: 10;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    padding: var(--space-8);
    display: grid;
    grid-template-columns: 1fr 400px;
    gap: var(--space-12);
    align-items: center;
  }

  .hero-text {
    max-width: 600px;
  }

  .hero-subtitle {
    font-size: var(--text-xl);
    margin: var(--space-6) 0 var(--space-8) 0;
    opacity: 0.9;
  }

  .hero-actions {
    display: flex;
    gap: var(--space-4);
    flex-wrap: wrap;
  }

  .terminal-container {
    justify-self: end;
  }

  /* Sections */
  .explorations-section,
  .projects-section,
  .podcast-section,
  .connect-section {
    padding: var(--space-20) var(--space-8);
    max-width: 1200px;
    margin: 0 auto;
  }

  .tech-radar-section,
  .constellation-section {
    padding: var(--space-16) 0;
    background: var(--color-bg-secondary);
  }

  .section-header {
    text-align: center;
    margin-bottom: var(--space-12);
  }

  .section-header .text-body {
    font-size: var(--text-lg);
    margin-top: var(--space-4);
  }

  .section-footer {
    text-align: center;
    margin-top: var(--space-12);
  }

  /* Explorations Grid */
  .explorations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-8);
  }

  .exploration-card {
    padding: var(--space-8);
    text-align: center;
    transition: transform var(--duration-300) var(--ease-out);
  }

  .exploration-card:hover {
    transform: translateY(-8px);
  }

  .exploration-icon {
    width: 60px;
    height: 60px;
    margin: 0 auto var(--space-6) auto;
    padding: var(--space-4);
    border-radius: var(--radius-2xl);
    background: linear-gradient(135deg, var(--color-primary-500), var(--color-secondary-500));
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .exploration-icon svg {
    width: 28px;
    height: 28px;
  }

  .exploration-tags {
    display: flex;
    justify-content: center;
    gap: var(--space-2);
    margin-top: var(--space-4);
    flex-wrap: wrap;
  }

  /* Projects Grid */
  .projects-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: var(--space-8);
  }

  /* Podcast Grid */
  .podcast-grid {
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
  }

  /* Connect Section */
  .connect-section {
    background: linear-gradient(135deg, 
      var(--color-primary-50), 
      var(--color-secondary-50)
    );
  }

  .dark .connect-section {
    background: linear-gradient(135deg, 
      var(--color-primary-950), 
      var(--color-secondary-950)
    );
  }

  .connect-content {
    text-align: center;
    padding: var(--space-12);
  }

  .connect-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: var(--space-6);
    margin-top: var(--space-10);
  }

  .connect-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: var(--space-8);
    background: var(--color-bg-primary);
    border-radius: var(--radius-2xl);
    border: 1px solid var(--color-border-primary);
    text-decoration: none;
    color: inherit;
    transition: all var(--duration-300) var(--ease-out);
  }

  .connect-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-xl);
    border-color: var(--color-primary-300);
  }

  .connect-icon {
    width: 48px;
    height: 48px;
    margin-bottom: var(--space-4);
    padding: var(--space-3);
    border-radius: var(--radius-xl);
    background: var(--color-primary-100);
    color: var(--color-primary-700);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .dark .connect-icon {
    background: var(--color-primary-900);
    color: var(--color-primary-300);
  }

  .connect-icon svg {
    width: 24px;
    height: 24px;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .hero-content {
      grid-template-columns: 1fr;
      gap: var(--space-8);
      text-align: center;
    }

    .terminal-container {
      justify-self: center;
    }

    .hero-subtitle {
      font-size: var(--text-lg);
    }

    .explorations-grid,
    .projects-grid {
      grid-template-columns: 1fr;
    }

    .connect-grid {
      grid-template-columns: 1fr;
    }

    .section-header .text-body {
      font-size: var(--text-base);
    }
  }

  @media (max-width: 480px) {
    .hero-actions {
      flex-direction: column;
    }

    .hero-actions .btn {
      width: 100%;
      justify-content: center;
    }
  }
</style>